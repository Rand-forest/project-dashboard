<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --terra: #C75B39;
      --terra-light: #E08B6F;
      --sage: #7A9D7E;
      --cream: #FAF7F2;
      --charcoal: #2D3436;
      --warm-gray: #6C757D;
    }
    
    body {
      font-family: 'Work Sans', sans-serif;
      background: linear-gradient(135deg, #FAF7F2 0%, #F5EEE6 100%);
      min-height: 100vh;
    }
    
    h1, h2, h3, h4 {
      font-family: 'Crimson Pro', serif;
    }
    
    .project-card {
      background: white;
      border: 2px solid #E8DED0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .project-card:hover {
      border-color: var(--terra);
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(199, 91, 57, 0.15);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--terra) 0%, var(--terra-light) 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(199, 91, 57, 0.3);
    }
    
    .status-badge {
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-size: 0.7rem;
    }
    
    .loading-spinner {
      border: 3px solid rgba(199, 91, 57, 0.1);
      border-radius: 50%;
      border-top: 3px solid var(--terra);
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    .progress-ring {
      transition: stroke-dashoffset 0.5s ease;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--terra);
      ring: 2px;
      ring-color: rgba(199, 91, 57, 0.2);
    }
    
    .modal-backdrop {
      backdrop-filter: blur(4px);
      animation: fadeIn 0.2s ease;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ============================================
    // CONFIGURATION - EDIT THESE VALUES
    // ============================================
    const CONFIG = {
      // Get these from Google Cloud Console (see setup instructions)
      CLIENT_ID: '50000852363-lfo75b0tdqj9ogomusjbt54a57qgfhcr.apps.googleusercontent.com',
      API_KEY: 'AIzaSyBf95XCReFCrnh9b-5zmRX9PDGzQEJqV_M',
      
      // Your Google Sheet ID (from the sheet URL)
      SPREADSHEET_ID: '1HASV36fYF80j30LuCQxUfiGtlxi6Hc-PIGBPZ7WvAUc',
      
      // Sheet names (must match your Google Sheet tabs)
      SHEETS: {
        PROJECTS: 'Projects',
        TASKS: 'Tasks'
      },
      
      // Google API settings
      DISCOVERY_DOCS: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
      SCOPES: 'https://www.googleapis.com/auth/spreadsheets'
    };

    // ============================================
    // GOOGLE SHEETS API CLIENT
    // ============================================
    class SheetsClient {
      constructor() {
        this.isSignedIn = false;
        this.gapiLoaded = false;
        this.gisLoaded = false;
        this.tokenClient = null;
      }

      async initialize() {
        return new Promise((resolve, reject) => {
          // Load Google API Client Library
          const gapiScript = document.createElement('script');
          gapiScript.src = 'https://apis.google.com/js/api.js';
          gapiScript.onload = () => {
            gapi.load('client', async () => {
              await gapi.client.init({
                apiKey: CONFIG.API_KEY,
                discoveryDocs: CONFIG.DISCOVERY_DOCS,
              });
              this.gapiLoaded = true;
              if (this.gisLoaded) resolve();
            });
          };
          document.head.appendChild(gapiScript);

          // Load Google Identity Services
          const gisScript = document.createElement('script');
          gisScript.src = 'https://accounts.google.com/gsi/client';
          gisScript.onload = () => {
            this.tokenClient = google.accounts.oauth2.initTokenClient({
              client_id: CONFIG.CLIENT_ID,
              scope: CONFIG.SCOPES,
              callback: '', // Will be set later
            });
            this.gisLoaded = true;
            if (this.gapiLoaded) resolve();
          };
          document.head.appendChild(gisScript);
        });
      }

      async authorize() {
        return new Promise((resolve, reject) => {
          this.tokenClient.callback = async (response) => {
            if (response.error) {
              reject(response);
              return;
            }
            this.isSignedIn = true;
            resolve(response);
          };
          
          if (gapi.client.getToken() === null) {
            this.tokenClient.requestAccessToken({ prompt: 'consent' });
          } else {
            this.tokenClient.requestAccessToken({ prompt: '' });
          }
        });
      }

      async getProjects() {
        const response = await gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          range: `${CONFIG.SHEETS.PROJECTS}!A2:H`,
        });
        
        const rows = response.result.values || [];
        return rows.map(row => ({
          id: row[0] || '',
          name: row[1] || '',
          description: row[2] || '',
          status: row[3] || 'active',
          priority: row[4] || 'medium',
          deadline: row[5] || '',
          createdAt: row[6] || new Date().toISOString(),
          createdBy: row[7] || ''
        }));
      }

      async getTasks() {
        const response = await gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          range: `${CONFIG.SHEETS.TASKS}!A2:F`,
        });
        
        const rows = response.result.values || [];
        return rows.map(row => ({
          id: row[0] || '',
          projectId: row[1] || '',
          title: row[2] || '',
          completed: row[3] === 'TRUE',
          createdAt: row[4] || new Date().toISOString(),
          createdBy: row[5] || ''
        }));
      }

      async addProject(project, userName) {
        const values = [[
          project.id,
          project.name,
          project.description,
          project.status,
          project.priority,
          project.deadline,
          project.createdAt,
          userName
        ]];

        await gapi.client.sheets.spreadsheets.values.append({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          range: `${CONFIG.SHEETS.PROJECTS}!A2`,
          valueInputOption: 'USER_ENTERED',
          resource: { values }
        });
      }

      async addTask(task, userName) {
        const values = [[
          task.id,
          task.projectId,
          task.title,
          task.completed ? 'TRUE' : 'FALSE',
          task.createdAt,
          userName
        ]];

        await gapi.client.sheets.spreadsheets.values.append({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          range: `${CONFIG.SHEETS.TASKS}!A2`,
          valueInputOption: 'USER_ENTERED',
          resource: { values }
        });
      }

      async updateProject(projectId, updates) {
        const projects = await this.getProjects();
        const rowIndex = projects.findIndex(p => p.id === projectId);
        if (rowIndex === -1) return;

        const project = { ...projects[rowIndex], ...updates };
        const values = [[
          project.id,
          project.name,
          project.description,
          project.status,
          project.priority,
          project.deadline,
          project.createdAt,
          project.createdBy
        ]];

        await gapi.client.sheets.spreadsheets.values.update({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          range: `${CONFIG.SHEETS.PROJECTS}!A${rowIndex + 2}`,
          valueInputOption: 'USER_ENTERED',
          resource: { values }
        });
      }

      async updateTask(taskId, updates) {
        const tasks = await this.getTasks();
        const rowIndex = tasks.findIndex(t => t.id === taskId);
        if (rowIndex === -1) return;

        const task = { ...tasks[rowIndex], ...updates };
        const values = [[
          task.id,
          task.projectId,
          task.title,
          task.completed ? 'TRUE' : 'FALSE',
          task.createdAt,
          task.createdBy
        ]];

        await gapi.client.sheets.spreadsheets.values.update({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          range: `${CONFIG.SHEETS.TASKS}!A${rowIndex + 2}`,
          valueInputOption: 'USER_ENTERED',
          resource: { values }
        });
      }

      async deleteProject(projectId) {
        const projects = await this.getProjects();
        const rowIndex = projects.findIndex(p => p.id === projectId);
        if (rowIndex === -1) return;

        await gapi.client.sheets.spreadsheets.batchUpdate({
          spreadsheetId: CONFIG.SPREADSHEET_ID,
          resource: {
            requests: [{
              deleteDimension: {
                range: {
                  sheetId: 0, // Projects sheet ID
                  dimension: 'ROWS',
                  startIndex: rowIndex + 1,
                  endIndex: rowIndex + 2
                }
              }
            }]
          }
        });

        // Also delete associated tasks
        const tasks = await this.getTasks();
        const taskRowsToDelete = tasks
          .map((t, i) => ({ task: t, index: i }))
          .filter(({ task }) => task.projectId === projectId)
          .reverse();

        for (const { index } of taskRowsToDelete) {
          await gapi.client.sheets.spreadsheets.batchUpdate({
            spreadsheetId: CONFIG.SPREADSHEET_ID,
            resource: {
              requests: [{
                deleteDimension: {
                  range: {
                    sheetId: 1, // Tasks sheet ID
                    dimension: 'ROWS',
                    startIndex: index + 1,
                    endIndex: index + 2
                  }
                }
              }]
            }
          });
        }
      }

      getUserEmail() {
        const token = gapi.client.getToken();
        if (!token) return 'Unknown User';
        
        // Decode the token to get user info
        try {
          const base64Url = token.access_token.split('.')[1];
          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
          const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          }).join(''));
          return JSON.parse(jsonPayload).email || 'Unknown User';
        } catch (e) {
          return 'Unknown User';
        }
      }
    }

    const sheetsClient = new SheetsClient();

    // ============================================
    // MAIN APP COMPONENT
    // ============================================
    function App() {
      const [initialized, setInitialized] = useState(false);
      const [authenticated, setAuthenticated] = useState(false);
      const [loading, setLoading] = useState(true);
      const [projects, setProjects] = useState([]);
      const [tasks, setTasks] = useState([]);
      const [selectedProject, setSelectedProject] = useState(null);
      const [view, setView] = useState('dashboard');
      const [showAddProject, setShowAddProject] = useState(false);
      const [error, setError] = useState('');
      const [userName, setUserName] = useState('');

      // Initialize Google API
      useEffect(() => {
        const init = async () => {
          try {
            await sheetsClient.initialize();
            setInitialized(true);
            setLoading(false);
          } catch (err) {
            setError('Failed to initialize Google API. Please check your configuration.');
            setLoading(false);
          }
        };
        init();
      }, []);

      // Authenticate and load data
      const handleSignIn = async () => {
        try {
          setLoading(true);
          setError('');
          await sheetsClient.authorize();
          setAuthenticated(true);
          setUserName(sheetsClient.getUserEmail());
          await loadData();
        } catch (err) {
          setError('Authentication failed. Please try again.');
          setLoading(false);
        }
      };

      // Load all data from sheets
      const loadData = async () => {
        try {
          const [projectsData, tasksData] = await Promise.all([
            sheetsClient.getProjects(),
            sheetsClient.getTasks()
          ]);
          setProjects(projectsData);
          setTasks(tasksData);
          setLoading(false);
        } catch (err) {
          setError('Failed to load data. Please check your sheet configuration.');
          setLoading(false);
        }
      };

      // Refresh data
      const refreshData = useCallback(async () => {
        if (!authenticated) return;
        try {
          await loadData();
        } catch (err) {
          console.error('Failed to refresh data:', err);
        }
      }, [authenticated]);

      // Auto-refresh every 30 seconds
      useEffect(() => {
        if (!authenticated) return;
        const interval = setInterval(refreshData, 30000);
        return () => clearInterval(interval);
      }, [authenticated, refreshData]);

      // Add project
      const addProject = async (projectData) => {
        try {
          const newProject = {
            id: String(Date.now()),
            ...projectData,
            createdAt: new Date().toISOString()
          };
          await sheetsClient.addProject(newProject, userName);
          await refreshData();
          setShowAddProject(false);
        } catch (err) {
          setError('Failed to add project. Please try again.');
        }
      };

      // Update project
      const updateProject = async (projectId, updates) => {
        try {
          await sheetsClient.updateProject(projectId, updates);
          await refreshData();
        } catch (err) {
          setError('Failed to update project. Please try again.');
        }
      };

      // Delete project
      const deleteProject = async (projectId) => {
        if (!confirm('Are you sure you want to delete this project? This will also delete all associated tasks.')) {
          return;
        }
        try {
          await sheetsClient.deleteProject(projectId);
          await refreshData();
          if (selectedProject?.id === projectId) {
            setSelectedProject(null);
            setView('dashboard');
          }
        } catch (err) {
          setError('Failed to delete project. Please try again.');
        }
      };

      // Add task
      const addTask = async (projectId, taskData) => {
        try {
          const newTask = {
            id: String(Date.now()),
            projectId,
            ...taskData,
            completed: false,
            createdAt: new Date().toISOString()
          };
          await sheetsClient.addTask(newTask, userName);
          await refreshData();
        } catch (err) {
          setError('Failed to add task. Please try again.');
        }
      };

      // Toggle task completion
      const toggleTask = async (taskId) => {
        try {
          const task = tasks.find(t => t.id === taskId);
          if (!task) return;
          await sheetsClient.updateTask(taskId, { completed: !task.completed });
          await refreshData();
        } catch (err) {
          setError('Failed to update task. Please try again.');
        }
      };

      const getProjectWithTasks = (projectId) => {
        const project = projects.find(p => p.id === projectId);
        if (!project) return null;
        return {
          ...project,
          tasks: tasks.filter(t => t.projectId === projectId)
        };
      };

      // Not initialized
      if (!initialized && loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="loading-spinner mx-auto mb-4"></div>
              <p className="text-warm-gray">Initializing...</p>
            </div>
          </div>
        );
      }

      // Not authenticated
      if (!authenticated) {
        return <SignInScreen onSignIn={handleSignIn} error={error} />;
      }

      // Loading data
      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="loading-spinner mx-auto mb-4"></div>
              <p className="text-warm-gray">Loading your projects...</p>
            </div>
          </div>
        );
      }

      // Main app
      return (
        <div className="min-h-screen">
          <Header
            projectCount={projects.length}
            onAddProject={() => setShowAddProject(true)}
            onRefresh={refreshData}
            userName={userName}
          />

          <main className="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            {error && (
              <div className="mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-lg">
                <p className="text-red-800">{error}</p>
                <button
                  onClick={() => setError('')}
                  className="mt-2 text-sm text-red-600 hover:text-red-800"
                >
                  Dismiss
                </button>
              </div>
            )}

            {view === 'dashboard' ? (
              <DashboardView
                projects={projects.map(p => getProjectWithTasks(p.id))}
                onSelectProject={(p) => {
                  setSelectedProject(p);
                  setView('project');
                }}
                onDeleteProject={deleteProject}
              />
            ) : (
              <ProjectView
                project={getProjectWithTasks(selectedProject.id)}
                onBack={() => {
                  setView('dashboard');
                  setSelectedProject(null);
                }}
                onUpdateProject={updateProject}
                onAddTask={addTask}
                onToggleTask={toggleTask}
              />
            )}
          </main>

          {showAddProject && (
            <AddProjectModal
              onAdd={addProject}
              onClose={() => setShowAddProject(false)}
            />
          )}
        </div>
      );
    }

    // ============================================
    // SIGN IN SCREEN
    // ============================================
    function SignInScreen({ onSignIn, error }) {
      return (
        <div className="min-h-screen flex items-center justify-center p-4">
          <div className="max-w-md w-full text-center animate-in">
            <div className="mb-8">
              <h1 className="text-5xl font-bold mb-3" style={{ color: 'var(--terra)' }}>
                Project Dashboard
              </h1>
              <p className="text-warm-gray text-lg">
                Collaborative project management powered by Google Sheets
              </p>
            </div>

            {error && (
              <div className="mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-lg">
                <p className="text-red-800 text-sm">{error}</p>
              </div>
            )}

            <button
              onClick={onSignIn}
              className="w-full py-4 px-6 btn-primary text-white rounded-lg font-semibold text-lg shadow-lg"
            >
              Sign in with Google
            </button>

            <p className="mt-6 text-sm text-warm-gray">
              Your data is stored in your Google Sheet.
              <br />
              Multiple team members can collaborate in real-time.
            </p>
          </div>
        </div>
      );
    }

    // ============================================
    // HEADER COMPONENT
    // ============================================
    function Header({ projectCount, onAddProject, onRefresh, userName }) {
      return (
        <header className="bg-white shadow-sm border-b-2 border-gray-200">
          <div className="max-w-7xl mx-auto px-4 py-5 sm:px-6 lg:px-8">
            <div className="flex justify-between items-center">
              <div>
                <h1 className="text-3xl font-bold" style={{ color: 'var(--charcoal)' }}>
                  Project Dashboard
                </h1>
                <p className="text-sm mt-1" style={{ color: 'var(--warm-gray)' }}>
                  {projectCount} projects ‚Ä¢ {userName}
                </p>
              </div>
              <div className="flex gap-3">
                <button
                  onClick={onRefresh}
                  className="px-4 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-gray-400 transition font-medium"
                  style={{ color: 'var(--charcoal)' }}
                >
                  ‚Üª Refresh
                </button>
                <button
                  onClick={onAddProject}
                  className="px-6 py-2 btn-primary text-white rounded-lg font-semibold shadow-md"
                >
                  + New Project
                </button>
              </div>
            </div>
          </div>
        </header>
      );
    }

    // ============================================
    // DASHBOARD VIEW
    // ============================================
    function DashboardView({ projects, onSelectProject, onDeleteProject }) {
      const getProjectStats = (project) => {
        const total = project.tasks?.length || 0;
        const completed = project.tasks?.filter(t => t.completed).length || 0;
        return { total, completed, progress: total > 0 ? (completed / total) * 100 : 0 };
      };

      const getStatusColor = (status) => {
        switch (status) {
          case 'active': return 'bg-green-100 text-green-800';
          case 'on-hold': return 'bg-yellow-100 text-yellow-800';
          case 'completed': return 'bg-blue-100 text-blue-800';
          default: return 'bg-gray-100 text-gray-800';
        }
      };

      const getPriorityColor = (priority) => {
        switch (priority) {
          case 'high': return 'var(--terra)';
          case 'medium': return 'var(--terra-light)';
          case 'low': return 'var(--sage)';
          default: return 'var(--warm-gray)';
        }
      };

      if (projects.length === 0) {
        return (
          <div className="text-center py-16 animate-in">
            <div className="text-6xl mb-4">üìã</div>
            <h3 className="text-2xl font-semibold mb-2" style={{ color: 'var(--charcoal)' }}>
              No projects yet
            </h3>
            <p style={{ color: 'var(--warm-gray)' }}>
              Click "New Project" to get started
            </p>
          </div>
        );
      }

      return (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {projects.map((project, index) => {
            const stats = getProjectStats(project);
            return (
              <div
                key={project.id}
                className="project-card rounded-xl p-6 animate-in"
                style={{ animationDelay: `${index * 0.1}s` }}
              >
                <div className="flex justify-between items-start mb-4">
                  <div className="flex-1">
                    <h3 className="text-xl font-bold mb-3" style={{ color: 'var(--charcoal)' }}>
                      {project.name}
                    </h3>
                    <div className="flex gap-2 mb-3">
                      <span className={`status-badge px-3 py-1 rounded-full ${getStatusColor(project.status)}`}>
                        {project.status}
                      </span>
                      <span
                        className="status-badge px-3 py-1 rounded-full font-semibold"
                        style={{ 
                          backgroundColor: `${getPriorityColor(project.priority)}20`,
                          color: getPriorityColor(project.priority)
                        }}
                      >
                        {project.priority}
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      onDeleteProject(project.id);
                    }}
                    className="text-gray-400 hover:text-red-500 transition text-xl"
                  >
                    √ó
                  </button>
                </div>

                {project.description && (
                  <p className="text-sm mb-4 line-clamp-2" style={{ color: 'var(--warm-gray)' }}>
                    {project.description}
                  </p>
                )}

                {project.deadline && (
                  <div className="flex items-center gap-2 text-sm mb-4" style={{ color: 'var(--warm-gray)' }}>
                    <span>üìÖ</span>
                    <span>Due: {new Date(project.deadline).toLocaleDateString()}</span>
                  </div>
                )}

                <div className="mb-4">
                  <div className="flex justify-between text-sm mb-2" style={{ color: 'var(--warm-gray)' }}>
                    <span>Progress</span>
                    <span className="font-semibold">{stats.completed}/{stats.total} tasks</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2.5">
                    <div
                      className="h-2.5 rounded-full transition-all duration-500"
                      style={{ 
                        width: `${stats.progress}%`,
                        background: 'linear-gradient(90deg, var(--terra) 0%, var(--terra-light) 100%)'
                      }}
                    />
                  </div>
                </div>

                <button
                  onClick={() => onSelectProject(project)}
                  className="w-full py-2.5 bg-gray-50 hover:bg-gray-100 rounded-lg transition font-medium"
                  style={{ color: 'var(--charcoal)' }}
                >
                  View Details ‚Üí
                </button>
              </div>
            );
          })}
        </div>
      );
    }

    // ============================================
    // PROJECT VIEW
    // ============================================
    function ProjectView({ project, onBack, onUpdateProject, onAddTask, onToggleTask }) {
      const [showAddTask, setShowAddTask] = useState(false);
      const [taskText, setTaskText] = useState('');

      const stats = {
        total: project.tasks?.length || 0,
        completed: project.tasks?.filter(t => t.completed).length || 0,
        progress: 0
      };
      stats.progress = stats.total > 0 ? (stats.completed / stats.total) * 100 : 0;

      const handleAddTask = () => {
        if (taskText.trim()) {
          onAddTask(project.id, { title: taskText.trim() });
          setTaskText('');
          setShowAddTask(false);
        }
      };

      return (
        <div className="animate-in">
          <button
            onClick={onBack}
            className="mb-6 flex items-center gap-2 font-medium hover:opacity-70 transition"
            style={{ color: 'var(--terra)' }}
          >
            ‚Üê Back to Dashboard
          </button>

          <div className="bg-white rounded-xl border-2 border-gray-200 p-8 mb-6">
            <h2 className="text-4xl font-bold mb-4" style={{ color: 'var(--charcoal)' }}>
              {project.name}
            </h2>
            {project.description && (
              <p className="text-lg mb-6" style={{ color: 'var(--warm-gray)' }}>
                {project.description}
              </p>
            )}

            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
              <div>
                <span className="text-sm" style={{ color: 'var(--warm-gray)' }}>Status</span>
                <p className="font-semibold text-lg capitalize" style={{ color: 'var(--charcoal)' }}>
                  {project.status}
                </p>
              </div>
              <div>
                <span className="text-sm" style={{ color: 'var(--warm-gray)' }}>Priority</span>
                <p className="font-semibold text-lg capitalize" style={{ color: 'var(--charcoal)' }}>
                  {project.priority}
                </p>
              </div>
              <div>
                <span className="text-sm" style={{ color: 'var(--warm-gray)' }}>Deadline</span>
                <p className="font-semibold text-lg" style={{ color: 'var(--charcoal)' }}>
                  {project.deadline ? new Date(project.deadline).toLocaleDateString() : 'None'}
                </p>
              </div>
              <div>
                <span className="text-sm" style={{ color: 'var(--warm-gray)' }}>Progress</span>
                <p className="font-semibold text-lg" style={{ color: 'var(--terra)' }}>
                  {Math.round(stats.progress)}%
                </p>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl border-2 border-gray-200 p-8">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold" style={{ color: 'var(--charcoal)' }}>
                Tasks ({stats.completed}/{stats.total})
              </h3>
              <button
                onClick={() => setShowAddTask(true)}
                className="px-4 py-2 btn-primary text-white rounded-lg font-medium"
              >
                + Add Task
              </button>
            </div>

            {showAddTask && (
              <div className="mb-6 flex gap-3">
                <input
                  type="text"
                  value={taskText}
                  onChange={(e) => setTaskText(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleAddTask()}
                  placeholder="Enter task name..."
                  className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg font-medium"
                  style={{ color: 'var(--charcoal)' }}
                  autoFocus
                />
                <button
                  onClick={handleAddTask}
                  className="px-6 py-3 btn-primary text-white rounded-lg font-medium"
                >
                  Add
                </button>
                <button
                  onClick={() => {
                    setShowAddTask(false);
                    setTaskText('');
                  }}
                  className="px-6 py-3 bg-gray-200 rounded-lg font-medium"
                  style={{ color: 'var(--charcoal)' }}
                >
                  Cancel
                </button>
              </div>
            )}

            <div className="space-y-3">
              {(!project.tasks || project.tasks.length === 0) && (
                <p className="text-center py-12" style={{ color: 'var(--warm-gray)' }}>
                  No tasks yet. Add one to get started!
                </p>
              )}
              {project.tasks?.map((task, index) => (
                <div
                  key={task.id}
                  className="flex items-center gap-4 p-4 hover:bg-gray-50 rounded-lg transition border-2 border-transparent hover:border-gray-200"
                  style={{ animationDelay: `${index * 0.05}s` }}
                >
                  <button
                    onClick={() => onToggleTask(task.id)}
                    className="flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition"
                    style={{
                      borderColor: task.completed ? 'var(--sage)' : 'var(--warm-gray)',
                      backgroundColor: task.completed ? 'var(--sage)' : 'transparent'
                    }}
                  >
                    {task.completed && <span className="text-white text-sm">‚úì</span>}
                  </button>
                  <span
                    className={`flex-1 text-lg ${task.completed ? 'line-through opacity-50' : ''}`}
                    style={{ color: 'var(--charcoal)' }}
                  >
                    {task.title}
                  </span>
                  {task.createdBy && (
                    <span className="text-sm" style={{ color: 'var(--warm-gray)' }}>
                      {task.createdBy.split('@')[0]}
                    </span>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // ADD PROJECT MODAL
    // ============================================
    function AddProjectModal({ onAdd, onClose }) {
      const [formData, setFormData] = useState({
        name: '',
        description: '',
        status: 'active',
        priority: 'medium',
        deadline: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        if (formData.name.trim()) {
          onAdd(formData);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-40 modal-backdrop flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-xl max-w-lg w-full p-8 border-2 border-gray-200 animate-in">
            <h3 className="text-3xl font-bold mb-6" style={{ color: 'var(--charcoal)' }}>
              New Project
            </h3>
            <form onSubmit={handleSubmit} className="space-y-5">
              <div>
                <label className="block text-sm font-semibold mb-2" style={{ color: 'var(--charcoal)' }}>
                  Project Name *
                </label>
                <input
                  type="text"
                  value={formData.name}
                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg font-medium"
                  style={{ color: 'var(--charcoal)' }}
                  required
                  autoFocus
                />
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2" style={{ color: 'var(--charcoal)' }}>
                  Description
                </label>
                <textarea
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg font-medium"
                  style={{ color: 'var(--charcoal)' }}
                  rows="3"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-semibold mb-2" style={{ color: 'var(--charcoal)' }}>
                    Status
                  </label>
                  <select
                    value={formData.status}
                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg font-medium"
                    style={{ color: 'var(--charcoal)' }}
                  >
                    <option value="active">Active</option>
                    <option value="on-hold">On Hold</option>
                    <option value="completed">Completed</option>
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-semibold mb-2" style={{ color: 'var(--charcoal)' }}>
                    Priority
                  </label>
                  <select
                    value={formData.priority}
                    onChange={(e) => setFormData({ ...formData, priority: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg font-medium"
                    style={{ color: 'var(--charcoal)' }}
                  >
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>
              </div>

              <div>
                <label className="block text-sm font-semibold mb-2" style={{ color: 'var(--charcoal)' }}>
                  Deadline (Optional)
                </label>
                <input
                  type="date"
                  value={formData.deadline}
                  onChange={(e) => setFormData({ ...formData, deadline: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg font-medium"
                  style={{ color: 'var(--charcoal)' }}
                />
              </div>

              <div className="flex gap-3 pt-4">
                <button
                  type="submit"
                  className="flex-1 py-3 btn-primary text-white rounded-lg font-semibold"
                >
                  Create Project
                </button>
                <button
                  type="button"
                  onClick={onClose}
                  className="flex-1 py-3 bg-gray-200 rounded-lg font-semibold"
                  style={{ color: 'var(--charcoal)' }}
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    // ============================================
    // RENDER APP
    // ============================================
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
